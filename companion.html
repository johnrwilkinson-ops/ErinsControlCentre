<!doctype html><meta charset='utf-8'><title>Companion</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<style>body{background:#0b1020;color:#e9ecf4;font:14px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:0}header{display:flex;gap:10px;padding:12px 16px;background:#0e1428;border-bottom:1px solid #222844;position:sticky;top:0}h1{font-size:18px;margin:0}.badge{font-size:12px;padding:6px 8px;border-radius:999px;border:1px solid #2b355f;background:#172046}.wrap{max-width:1100px;margin:0 auto;padding:16px}.grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}.card{background:#0f1428;border:1px solid #222844;border-radius:14px;padding:12px}.kv{display:grid;grid-template-columns:200px 1fr;gap:8px}.kv div:nth-child(odd){color:#aab1bf}.kv div:nth-child(even){font-weight:600}@media(max-width:800px){.grid{grid-template-columns:1fr}.kv{grid-template-columns:140px 1fr}}</style>
<header><h1>Companion</h1><span class="badge">Room: <span id="room">main</span></span><span class="badge">Mode: <span id="mode">Live</span></span><span class="badge">Last update: <span id="ts">—</span></span></header>
<div class="wrap"><div class="grid">
<section class="card"><h2>Session</h2><div class="kv">
<div>Length</div><div id="lengthLabel">—</div>
<div>Length (mins)</div><div id="lengthMins">—</div>
<div>Difficulty</div><div id="difficulty">—</div>
<div>d10 (X)</div><div id="d10">—</div>
<div>Notes</div><div id="notes">—</div>
</div></section>
<section class="card"><h2>Timers</h2><div class="kv">
<div>Prep</div><div id="prepTimer">00:00</div>
<div>Session</div><div id="sessTimer">00:00</div>
<div>Status</div><div id="which">—</div>
</div></section>
<section class="card"><h2>Builder Picks</h2><div class="kv">
<div>Scenario / Clothing</div><div id="scenario">—</div>
<div>Hoods</div><div id="hoods">—</div>
<div>Gags</div><div id="gags">—</div>
<div>Extras</div><div id="extras">—</div>
<div>Anal</div><div id="anal">—</div>
<div>Fucking Machine</div><div id="fm">—</div>
<div>Location</div><div id="location">—</div>
<div>Position</div><div id="position">—</div>
<div>Vibrating Wand</div><div id="wand">—</div>
<div>Audio</div><div id="audio">—</div>
<div>Restriction</div><div id="restriction">—</div>
<div>Nipples</div><div id="nipples">—</div>
<div>E-Stim</div><div id="estim">—</div>
<div>Collar</div><div id="collar">—</div>
</div></section>
<section class="card"><h2>Outcomes</h2><div class="kv">
<div>Punishment</div><div id="punishment">—</div>
<div>Reward</div><div id="reward">—</div>
</div></section></div></div>
<script>
(function(){
  function set(id,val){var el=document.getElementById(id); if(el) el.textContent=(val==null||val==='')?'—':val;}
  function fmt(ms){var s=Math.max(0,(ms||0)/1000|0),m=s/60|0;return (''+m).padStart(2,'0')+':'+(''+(s%60)).padStart(2,'0');}
  function applyState(st){
    set('lengthLabel', st.lengthLabel); set('lengthMins', st.lengthMins);
    set('difficulty', st.difficulty); set('d10', st.d10);
    set('notes', (st.notes||[]).join(' • '));
    var p = st.picks||{};
    ['scenario','hoods','gags','extras','anal','fm','location','position','wand','audio','restriction','nipples','estim','collar','punishment','reward']
      .forEach(function(k){ set(k, p[k]); });
    var t = st.timers||{}; set('prepTimer', fmt(t.prep)); set('sessTimer', fmt(t.session)); set('which', t.which||'—');
  }
  function live(room){
    var url='/.netlify/functions/get-state?room='+encodeURIComponent(room||'main');
    return fetch(url).then(function(r){return r.json()}).then(function(j){ if(j&&j.state){ applyState(j.state); } document.getElementById('ts').textContent=new Date().toLocaleTimeString(); });
  }
  function init(){
    var qs=new URLSearchParams(location.search); var room=qs.get('room')||'main'; document.getElementById('room').textContent=room;
    setInterval(function(){ live(room); }, 1500); live(room);
  }
  if(document.readyState==='loading') document.addEventListener('DOMContentLoaded', init); else init();
})();
</script>